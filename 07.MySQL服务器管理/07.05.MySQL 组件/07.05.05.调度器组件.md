

## **7.5.5 调度器组件**





> **注意**

> scheduler 组件包含在 **MySQL Enterprise Edition（商业版）** 中。如需了解商业产品详情，请访问 https://www.mysql.com/products/。



从 MySQL 8.0.34 起，scheduler 组件提供了 mysql_scheduler 服务的实现，使应用程序、组件或插件可以每隔 *N* 秒配置、运行和取消配置任务。例如，audit_log 服务器插件在初始化时调用 scheduler 组件，并配置定期刷新其内存缓存的任务（参见 [启用审计日志刷新任务](https://dev.mysql.com/doc/refman/8.0/en/audit-log-logging-configuration.html#audit-log-flush-task)）。



- **用途**：实现系统变量 [component_scheduler.enabled](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_component_scheduler.enabled)，用于控制调度器是否处于激活执行任务状态。启动时，scheduler 组件会注册 performance_schema.component_scheduler_tasks 表，该表列出了当前调度的任务以及每个任务的一些运行时数据。
- **URN**：file://component_scheduler





> 安装说明参见 [第 7.5.1 节，“安装和卸载组件”](https://dev.mysql.com/doc/refman/8.0/en/component-loading.html)。



scheduler 组件通过以下要素实现其服务：



- 一个优先队列：保存已注册但尚未激活的调度任务，按“下一次运行时间”升序排列。

- 一个活动任务列表：保存已注册且正在运行的任务。

- 一个后台线程，该线程：

  

  - 当无任务或下一个任务尚未到达运行时间时进入休眠，周期性唤醒检查是否需要终止。
  - 编译出需要运行的任务列表，将其从“未激活队列”移动到“激活队列”，并逐个执行。
  - 执行完后将任务从“激活列表”移除，重新添加回“未激活队列”，并计算下一次运行时间。

  





当调用者调用 mysql_scheduler.create() 服务时，会创建一个新的调度任务实例并加入队列，同时通知后台线程的信号量。调用者将获得一个任务句柄，需在调用 mysql_scheduler.destroy() 后才释放。调用 destroy() 并传入创建时返回的句柄后，服务将等待该任务（若在运行中）完成并将其从未激活队列中移除。



组件服务会按任务所需的运行时间升序、逐个在同一个调度器线程中调用由应用程序提供的回调函数（函数指针）。



> 若开发者希望在应用程序、组件或插件中使用调度器队列功能，请查阅 MySQL 源码发行版中的 mysql_scheduler.h 文件。
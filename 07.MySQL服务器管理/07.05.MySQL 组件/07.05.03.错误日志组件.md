### 7.5.3 错误日志组件

本节描述各个错误日志组件的特性。如需了解错误日志配置的一般信息，请参见 [第 7.4.2 节，“错误日志”](#742-错误日志)。

一个日志组件可以是 **过滤器（filter）** 或 **接收器（sink）**：

- **过滤器** 用于处理日志事件，可添加、移除或修改事件字段，或完全删除事件。处理后的事件将传递给启用组件列表中的下一个日志组件。
- **接收器** 是日志事件的目的地（写入器）。通常，一个接收器会将日志事件处理为特定格式的日志消息，并将这些消息写入其关联的输出位置，如文件或系统日志。接收器也可以写入 `Performance Schema` 的 `error_log` 表；参见 [第 29.12.21.2 节，“error_log 表”](#)。事件在传递给启用组件列表中的下一个组件时不会被修改（即使接收器格式化事件以生成输出，它也不会修改事件本身）。

系统变量 log_error_services 的值列出了已启用的日志组件。未在列表中的组件则被禁用。从 MySQL 8.0.30 开始，`log_error_services` 也会隐式加载尚未加载的错误日志组件。更多信息参见 [第 7.4.2.1 节，“错误日志配置”](#)。

以下小节按组件类型对日志组件进行分组说明：

- [过滤器错误日志组件](#过滤器错误日志组件)
- [接收器错误日志组件](#接收器错误日志组件)

组件描述包括以下信息：

- 组件名称与用途
- 该组件是内建的还是需要加载的；若为可加载组件，则说明在使用 `INSTALL COMPONENT` 和 UNINSTALL COMPONENT 明确加载或卸载时应使用的 URN。隐式加载时只需指定组件名称。
- 该组件是否可在 `log_error_services` 中多次列出。
- 对于接收器组件，其输出目的地。
- 对于接收器组件，是否支持写入 `Performance Schema` 的 error_log 表。

#### 过滤器错误日志组件

过滤器组件实现对错误日志事件的过滤。如果没有启用任何过滤器组件，则不会进行过滤。

启用的过滤器组件只会影响 log_error_services 中排在它之后的组件。特别是，如果某个接收器组件在过滤器组件之前列出，则不会对该接收器进行日志事件过滤。

##### log_filter_internal 组件

- **用途**：根据日志事件的优先级和错误码进行过滤，配合系统变量 log_error_verbosity 和 log_error_suppression_list 使用。参见 [第 7.4.2.5 节，“基于优先级的错误日志过滤（log_filter_internal）”](#)。
- **URN**：该组件为内建组件，无需加载。
- **是否允许多次使用**：否。

若 `log_filter_internal` 被禁用，则 `log_error_verbosity` 和 `log_error_suppression_list` 将不生效。

##### log_filter_dragnet 组件

- **用途**：根据 dragnet.log_error_filter_rules 系统变量定义的规则进行过滤。参见 [第 7.4.2.6 节，“基于规则的错误日志过滤（log_filter_dragnet）”](#)。
- **URN**：file://component_log_filter_dragnet
- **是否允许多次使用**：否。

#### 接收器错误日志组件

接收器组件是实现错误日志输出的写入器。如果没有启用任何接收器组件，则不会有日志输出。

部分接收器组件会提到“默认错误日志目标”，即控制台或文件，由系统变量 log_error 的值决定。详见 [第 7.4.2.2 节，“默认错误日志目标配置”](#)。

##### log_sink_internal 组件

- **用途**：实现传统的错误日志消息输出格式。
- **URN**：该组件为内建组件，无需加载。
- **是否允许多次使用**：否。
- **输出目标**：写入默认的错误日志目标。
- **Performance Schema 支持**：写入 error_log 表，提供读取旧实例日志文件的解析器。

##### log_sink_json 组件

- **用途**：以 JSON 格式实现错误日志记录。参见 [第 7.4.2.7 节，“JSON 格式错误日志记录”](#)。
- **URN**：file://component_log_sink_json
- **是否允许多次使用**：是。
- **输出目标**：
  - 若 log_error 指定为文件，则输出文件名基于该文件，加上编号后缀 .NN.json，从 00 开始。例如，若 log_error 为 file_name，多个实例将输出至：file_name.00.json、file_name.01.json等；
  - 若 log_error 为 stderr，则输出至控制台。若 log_sink_json 在 log_error_services 中被多次列出，则所有实例均写入控制台，通常这并不实用。
- **Performance Schema 支持**：写入 error_log 表，提供旧日志文件的解析器。

##### log_sink_syseventlog 组件

- **用途**：将错误日志写入系统日志。Windows 为事件日志（Event Log），Unix 及类 Unix 系统为 syslog。参见 [第 7.4.2.8 节，“系统日志记录”](#)。
- **URN**：file://component_log_sink_syseventlog
- **是否允许多次使用**：否。
- **输出目标**：写入系统日志，不使用默认日志目标。
- **Performance Schema 支持**：不写入 error_log 表，不提供日志解析器。

##### log_sink_test 组件

- **用途**：供内部测试用，不建议在生产环境中使用。
- **URN**：file://component_log_sink_test

因为是内部用途，log_sink_test 的属性（如是否支持多次使用、输出目标等）未指定，其行为可能随时更改。
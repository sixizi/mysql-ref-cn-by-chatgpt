



## **7.6.7.4 克隆与并发 DDL（Cloning and Concurrent DDL）**





在 MySQL 8.0.27 之前，克隆操作期间，donor 和 recipient MySQL 实例上均不允许执行 DDL 操作，包括 TRUNCATE TABLE。选择数据源时应考虑此限制。

一种解决方法是使用专门的 donor 实例，从而允许在数据克隆时阻止 DDL 操作。



为防止克隆期间的并发 DDL，系统会在 donor 和 recipient 上获取一个**独占备份锁**。

变量 `clone_ddl_timeout` 定义了克隆操作在 donor 和 recipient 上等待备份锁的时间（单位：秒）。默认值为 **300 秒**。

如果在规定时间内未获取到备份锁，克隆操作将失败并返回错误。



从 MySQL 8.0.27 开始，默认允许在 donor 上执行并发 DDL。

此行为受变量 `clone_block_ddl` 控制，可以通过 `SET` 语句动态启用或禁用：

```
SET GLOBAL clone_block_ddl = {OFF|ON};
```

默认设置为 `clone_block_ddl=OFF`，即允许 donor 执行并发 DDL。



> 并发 DDL 操作是否被克隆取决于该操作是否在克隆操作创建动态快照之前完成。



无论 `clone_block_ddl` 设置为何，以下 DDL 操作在克隆期间**始终不被允许**：

```
ALTER TABLE tbl_name DISCARD TABLESPACE;
ALTER TABLE tbl_name IMPORT TABLESPACE;
ALTER INSTANCE DISABLE INNODB REDO_LOG;
```
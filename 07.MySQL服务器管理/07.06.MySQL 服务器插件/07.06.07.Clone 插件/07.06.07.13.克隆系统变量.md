#### 7.6.7.13 克隆系统变量

本节介绍用于控制 clone 插件操作的一系列系统变量。如果启动时指定的值不正确，clone 插件可能无法正确初始化，服务器将不会加载它，并可能因不识别其他克隆设置而输出错误信息。

每个系统变量都有一个 **默认值**。可以在服务器启动时通过命令行或配置文件设置系统变量。也可在运行时使用 SET 语句动态更改，从而修改服务器行为，无需重启服务器。

通常修改全局系统变量需具备 `SYSTEM_VARIABLES_ADMIN`（或已弃用的 `SUPER`）权限，并且变量设置在执行克隆操作所在的 recipient MySQL 实例上。

- **clone_autotune_concurrency**

    | **属性**          | **值**                       |
    | ----------------- | ---------------------------- |
    | 命令行格式        | --clone-autotune-concurrency |
    | 引入版本          | 8.0.17                       |
    | 系统变量          | clone_autotune_concurrency   |
    | 作用域            | Global                       |
    | 动态修改          | Yes                          |
    | 支持 SET_VAR Hint | No                           |
    | 类型              | Boolean                      |
    | 默认值            | ON                           |

    当启用 `clone_autotune_concurrency`（默认启用）时，远程克隆操作会动态生成额外的线程以优化数据传输速度。该设置仅适用于 recipient MySQL 服务器实例。

    在克隆操作期间，线程数会逐步增加，目标是当前线程数的两倍。每次递增后都会评估数据传输速度的变化，根据以下规则决定是否继续：

    - 如果传输速度下降超过 5%，则停止线程增加；

    - 如果在达到目标的 25% 时提升至少 5%，继续增加线程，否则停止；

    - 如果在达到目标的 50% 时提升至少 10%，继续增加线程，否则停止；

    - 如果在达到目标时提升至少 25%，将新目标设为当前线程数的两倍并继续增加线程，否则停止。

    自动调优过程**不支持减少线程数量**。

    最大可生成线程数由 `clone_max_concurrency` 变量定义；

    若禁用 clone_autotune_concurrency，则远程克隆操作会直接使用 `clone_max_concurrency` 指定的线程数量。

- **clone_buffer_size**

    | **属性**          | **值**               |
    | ----------------- | -------------------- |
    | 命令行格式        | --clone-buffer-size  |
    | 引入版本          | 8.0.17               |
    | 系统变量          | clone_buffer_size    |
    | 作用域            | Global               |
    | 动态修改          | Yes                  |
    | 支持 SET_VAR Hint | No                   |
    | 类型              | Integer              |
    | 默认值            | 4194304（4 MiB）     |
    | 最小值            | 1048576（1 MiB）     |
    | 最大值            | 268435456（256 MiB） |
    | 单位              | bytes                |

    定义本地克隆操作中用于传输数据的中间缓冲区大小。默认值为 4 MiB。增大缓冲区大小可能允许 I/O 设备驱动并行抓取数据，从而提升克隆性能。

- **clone_block_ddl**

    | **属性**          | **值**            |
    | ----------------- | ----------------- |
    | 命令行格式        | --clone-block-ddl |
    | 引入版本          | 8.0.27            |
    | 系统变量          | clone_block_ddl   |
    | 作用域            | Global            |
    | 动态修改          | Yes               |
    | 支持 SET_VAR Hint | No                |
    | 类型              | Boolean           |
    | 默认值            | OFF               |

    在克隆操作期间，在 donor MySQL 服务器实例上启用独占的备份锁，从而阻止并发执行的 DDL 操作。参见 [第 7.6.7.4 节，“Cloning and Concurrent DDL”](#7-6-7-4-cloning-and-concurrent-ddl)。

- **clone_delay_after_data_drop**

    | **属性**          | **值**                        |
    | ----------------- | ----------------------------- |
    | 命令行格式        | --clone-delay-after-data-drop |
    | 引入版本          | 8.0.29                        |
    | 系统变量          | clone_delay_after_data_drop   |
    | 作用域            | Global                        |
    | 动态修改          | Yes                           |
    | 支持 SET_VAR Hint | No                            |
    | 类型              | Integer                       |
    | 默认值            | 0                             |
    | 最小值            | 0                             |
    | 最大值            | 3600                          |
    | 单位              | seconds                       |

    指定在远程克隆操作开始时，从 recipient MySQL 服务器实例移除现有数据后等待的延迟时间。此延迟是为了让 recipient 主机上的文件系统有充足时间释放空间，然后再从 donor 克隆数据。某些文件系统（如 VxFS）采用异步后台进程释放空间，若过早开始克隆可能因空间不足而失败。最长延迟为 3600 秒（1 小时），默认值为 0（无延迟）。该变量仅适用于远程克隆操作，并应在 recipient MySQL 服务器实例上配置。
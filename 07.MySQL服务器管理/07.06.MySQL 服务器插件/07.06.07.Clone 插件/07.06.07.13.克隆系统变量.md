

## **7.6.7.13 克隆系统变量（Clone System Variables）**





本节介绍用于控制 clone 插件操作的一系列系统变量。如果启动时指定的值不正确，clone 插件可能无法正确初始化，服务器将不会加载它，并可能因不识别其他克隆设置而输出错误信息。



- 每个系统变量都有一个 **默认值**。
- 可以在服务器启动时通过命令行或配置文件设置系统变量。
- 也可在运行时使用 SET 语句动态更改，从而修改服务器行为，无需重启服务器。
- 通常修改全局系统变量需具备 SYSTEM_VARIABLES_ADMIN（或已弃用的 SUPER）权限，并且变量设置在执行克隆操作所在的 recipient MySQL 实例上。





------





### **clone_autotune_concurrency**





- 启用格式：--clone-autotune-concurrency

- 引入版本：8.0.17

- 系统变量：clone_autotune_concurrency

- 作用域：全局（Global）、可动态修改

- 类型：Boolean，默认值：ON

- 当启用该变量时（默认情形），远程克隆将在 recipient 实例上动态生成额外线程以优化数据传输速度。

- 克隆过程中，线程数量会逐步递增 (current * 2 为目标)，并在每次增量后评估速度变化：

  

  - 若速度下降超过 5%，则停止增量；
  - 达到目标的 25% 后若提升 ≥ 5% 则继续，否则停止；
  - 达到目标的 50% 后若提升 ≥ 10% 则继续，否则停止；
  - 达到目标后若提升 ≥ 25% 则以新目标继续，否则停止；

  

- 自动调优仅支持增加线程，不支持减少；

- 最大线程数量由 clone_max_concurrency 控制；

- 若禁用自动调优，则 clone_max_concurrency 决定线程数量。





------





### **clone_buffer_size**





- 启用格式：--clone-buffer-size
- 引入版本：8.0.17
- 类型：Integer（全局、可动态修改）
- 默认值：4194304（4 MiB），范围：1 MiB ≤ 值 ≤ 256 MiB
- 指定本地克隆操作传输数据时使用的中间缓存大小。较大缓存可提升 I/O 并行性能，从而提高克隆速度。





------





### **clone_block_ddl**





- 启用格式：--clone-block-ddl
- 引入版本：8.0.27
- 类型：Boolean（全局、可动态）
- 默认值：OFF
- 若启用，在克隆期间在 donor 实例上启用独占备份锁，阻止并发的 DDL 操作（详见 7.6.7.4 节）。





------





### **clone_delay_after_data_drop**





- 启用格式：--clone-delay-after-data-drop
- 引入版本：8.0.29
- 类型：Integer（全局、可动态），单位秒
- 默认值：0，范围：0 ≤ 值 ≤ 3600
- 在远程克隆操作开始时，在 recipient 实例上删除旧数据后插入延迟，以等待文件系统释放空间（某些文件系统异步释放）；防止因空间未释放而导致克隆失败。仅适用于远程克隆。





------





### **clone_ddl_timeout**





- 启用格式：--clone-ddl-timeout
- 引入版本：8.0.17
- 类型：Integer（全局、可动态），单位秒
- 默认值：300，范围：0 ≤ 值 ≤ 2592000（30 天）
- 指定克隆等待获取备份锁的最大时间。设置为 0 则跳过等待，但可能在并发 DDL 情况下失败。适用于 donor 和 recipient 实例。





------





### **clone_donor_timeout_after_network_failure**





- 启用格式：--clone-donor-timeout-after-network-failure
- 引入版本：8.0.24
- 类型：Integer（全局、可动态），单位分钟
- 默认值：5，范围：0 ≤ 值 ≤ 30
- 指定在 donor 端发生网络故障时，允许 recipient 在多长时间内恢复连接并继续克隆。若时间到尚未恢复，则克隆中止且 donor 丢弃快照。值为 0 时故障发生即丢弃快照。仅在 donor 实例上生效。





------





### **clone_enable_compression**





- 启用格式：--clone-enable-compression
- 引入版本：8.0.17
- 类型：Boolean（全局、可动态），默认：OFF
- 启用后 remote 克隆期间网络传输数据将压缩传输，节省网络带宽但增加 CPU 使用。仅在 recipient 实例上生效。





------





### **clone_max_concurrency**





- 启用格式：--clone-max-concurrency
- 引入版本：8.0.17
- 类型：Integer（全局、可动态），范围：1 ≤ 值 ≤ 128，默认值：16
- 指定远程克隆最大并发线程数。提高线程数可提升性能，但可能影响客户端连接数。仅在 recipient 实例上生效。





------





### **clone_max_data_bandwidth**





- 启用格式：--clone-max-data-bandwidth
- 引入版本：8.0.17
- 类型：Integer（全局、可动态），单位 MiB/s，范围：0 ≤ 值 ≤ 1048576，默认：0（无限制）
- 限制远程克隆的数据传输速率。以线程为单位，建议每线程最低 1 MiB/s。若报告的 DATA_SPEED（Performance Schema）低于预期且带宽充足，请检查 donor/recipient 的 I/O 状况。





------





### **clone_max_network_bandwidth**





- 启用格式：--clone-max-network-bandwidth
- 引入版本：8.0.17
- 类型：Integer（全局、可动态），单位 MiB/s，范围：0 ≤ 值 ≤ 1048576，默认：0（无限制）
- 限制远程克隆网络传输速率，适用于 donor 的网络瓶颈情况。仅在 recipient 实例上生效。





------





### **clone_ssl_ca**

### **,** 

### **clone_ssl_cert**

### **,** 

### **clone_ssl_key**





- 启用格式分别为：

  

  - --clone-ssl-ca=file_name
  - --clone-ssl-cert=file_name
  - --clone-ssl-key=file_name

  

- 引入版本：8.0.14

- 类型：File name（全局、可动态），默认：空

- 分别指定 CA 文件、客户端证书、公钥和私钥路径，用于配置远程克隆的加密连接。仅在 recipient 实例上设置。





------





### **clone_valid_donor_list**





- 启用格式：--clone-valid-donor-list=value
- 引入版本：8.0.17
- 类型：String（全局、可动态），默认：NULL
- 指定允许进行远程克隆的 donor 主机地址列表，格式如 "HOST1:PORT1,HOST2:PORT2"。不允许空格。支持 IPv4 地址或 IPv6 的别名（不支持直接 IPv6 地址）。
- 此变量为 recipient 上的安全控制设置，只能从列表中的 donor 进行克隆。配置此变量需 SYSTEM_VARIABLES_ADMIN 权限，而执行克隆需 CLONE_ADMIN 权限。





------



以上变量用于控制 clone 插件的行为，支持动态调整，你可根据不同环境和需求灵活配置。
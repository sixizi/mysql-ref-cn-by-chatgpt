#### 7.6.7.1 安装 Clone 插件





本节介绍如何安装和配置 clone 插件。对于远程克隆操作，必须在 **donor** 和 **recipient** 的 MySQL 服务器实例上安装 clone 插件。



关于安装或卸载插件的一般信息，请参见 [7.6.1节，安装和卸载插件](#7-6-1-installing-and-uninstalling-plugins)。



要使服务器能够使用插件，插件库文件必须位于 MySQL 插件目录中（由系统变量 plugin_dir 指定的目录）。如有需要，可以在服务器启动时设置 plugin_dir 的值来指定插件目录的位置。



插件库文件的基本名称为 mysql_clone.so。文件名后缀因平台而异（例如，Unix 和类 Unix 系统为 .so，Windows 为 .dll）。





### **启动时加载插件**





要在服务器启动时加载插件，请使用 --plugin-load-add 选项指定包含插件的库文件名。使用此加载方式时，必须在每次服务器启动时都提供该选项。例如，在 my.cnf 文件中添加以下内容，并根据您的平台调整插件库文件名后缀：

```
[mysqld]
plugin-load-add=mysql_clone.so
```

修改 my.cnf 后，重启服务器使新设置生效。



> **注意**

> 升级 MySQL 版本期间重启服务器时，无法使用 --plugin-load-add 加载 clone 插件。例如，从 MySQL 5.7 升级到 8.0 后，如果尝试使用 plugin-load-add=mysql_clone.so 启动服务器，会出现以下错误：

> [ERROR] [MY-013238] [Server] Error installing plugin 'clone': Cannot install during upgrade.

> 解决方法是在升级完成后，再使用 plugin-load-add=mysql_clone.so 启动服务器。





### **运行时加载插件**





或者，可以在运行时使用以下语句加载插件，请根据平台调整 .so 后缀：

```
INSTALL PLUGIN clone SONAME 'mysql_clone.so';
```

INSTALL PLUGIN 会加载插件，并将其注册到 mysql.plugins 系统表中，以便在后续的正常服务器启动中无需再使用 --plugin-load-add。





### **验证插件安装**





可以查看 Information Schema 中的 PLUGINS 表，或使用 SHOW PLUGINS 语句来验证插件是否安装成功。参见 [7.6.2节，获取服务器插件信息](#7-6-2-obtaining-server-plugin-information)。例如：

```
mysql> SELECT PLUGIN_NAME, PLUGIN_STATUS
         FROM INFORMATION_SCHEMA.PLUGINS
        WHERE PLUGIN_NAME = 'clone';
+------------------------+---------------+
| PLUGIN_NAME            | PLUGIN_STATUS |
+------------------------+---------------+
| clone                  | ACTIVE        |
+------------------------+---------------+
```

如果插件初始化失败，请检查服务器错误日志中是否有与 clone 或插件相关的诊断信息。





### **控制插件激活状态**





如果插件已经通过 INSTALL PLUGIN 注册，或通过 --plugin-load-add 加载，可以在服务器启动时使用 --clone 选项来控制插件的激活状态。例如，要在启动时加载插件并防止其在运行时被移除，可使用以下配置：

```
[mysqld]
plugin-load-add=mysql_clone.so
clone=FORCE_PLUS_PERMANENT
```

如果希望在插件初始化失败时阻止服务器运行，可以将 --clone 设置为 FORCE 或 FORCE_PLUS_PERMANENT，以强制插件成功初始化，否则启动失败。



更多关于插件激活状态的信息，请参见 [控制插件激活状态](#controlling-plugin-activation-state)。